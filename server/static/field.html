<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<canvas id="myCanvas" width="600" height="400" style="border:1px solid #000000;"></canvas>
	<script src="http://128.237.171.237:3000/socket.io/socket.io.js"></script>
	<script>
	// Make a connection to the socket.io server
	// This also fires the "connection" event, but it doesn't matter
	var socket = io.connect('http://128.237.171.237:3000/');

	// When getting a "receive" event from the server
	socket.on('receive', function(data) {
		// update paddle acceleration
		//console.log(data);
		if(data.accel1 !== undefined)
		{
			//console.log(data.accel1);
			paddle1.accel = -data.accel1;
		}
		
		if(data.accel2 !== undefined)
		{
			//console.log(data.accel2);
			paddle2.accel = -data.accel2;
		}
	});
	
	var ball;
	var paddle1, paddle2;
	var score1, score2;
	var intervalId, timerDelay;
	window.onload = function(){
		timerDelay = 50;
		ball = new Ball();
		paddle1 = new Paddle(1);
		paddle2 = new Paddle(2);
		score1 = 0;
		score2 = 0;
		intervalId = setInterval(onTimer, timerDelay);
	}
	
	var canvas = document.getElementById("myCanvas");
	var ctx = canvas.getContext("2d");
	
	function Ball(){
		this.x = canvas.width / 4;
		this.y = canvas.height / 4;
		this.color = "#000066";
		this.velx = 9;
		this.vely = 9;
		this.radius = 10;
	}
	
	function Paddle(player){
		this.length = 80;
		this.vel = 0;
		this.accel = 0;
		this.y = canvas.height/2;
		if(player === 1)
		{
			this.color = "#D147A3";
			this.x = 8;
		}
		else
		{
			this.color = "orange";
			this.x = canvas.width - 8;
		}
	}
	
	function updateBall(){
		ball.x += ball.velx;
		ball.y += ball.vely;
		
		// bounce off player 2's paddle
		if(ball.x + ball.radius >= paddle2.x && Math.abs(ball.y - paddle2.y) <= paddle2.length/2)
		{
			ball.x = paddle2.x - ball.radius;
			ball.velx *= -1;
			ball.vely = (ball.y - paddle2.y)/10;
			console.log("Bounce!");
		}
		
		// bounce off player 1's paddle
		if(ball.x - ball.radius <= paddle1.x && Math.abs(ball.y - paddle1.y) <= paddle1.length/2)
		{
			ball.x = paddle1.x + ball.radius;
			ball.velx *= -1;
			ball.vely = (ball.y - paddle1.y)/10;
			console.log("Bounce!");
		}
		
		// hit player 2's wall
		if(ball.x + ball.radius > canvas.width)
		{
			ball.velx *= -1;
			console.log("player2 loses");
			ball.x = canvas.width/2;
			ball.y = canvas.height/2;
			score1++;
		}
		// hit player 1's wall
		if(ball.x - ball.radius < 0)
		{
			ball.velx *= -1;
			console.log("player1 loses");
			ball.x = canvas.width/2;
			ball.y = canvas.height/2;
			score2++;
		}
		
		// bounce off sides
		if(ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0)
		{
			ball.vely *= -1;
		}
	}
	
	function drawBall(){
		ctx.fillStyle = ball.color;
		ctx.beginPath();
		ctx.arc(ball.x, ball.y, ball.radius, 0, 2*Math.PI, true);
		ctx.fill();
	}
	
	function updatePaddles(){
		// move player 1
		//paddle1.vel += paddle1.accel;
		paddle1.vel = paddle1.accel;
		if(paddle1.y + paddle1.vel >= canvas.height || paddle1.y + paddle1.vel <= 0)
		{
			paddle1.accel = 0;
			paddle1.vel = 0;
		}
		paddle1.y += paddle1.vel;
		
		// move player 2
		//paddle2.vel += paddle2.accel;
		paddle2.vel = paddle2.accel;
		if(paddle2.y + paddle2.vel >= canvas.height || paddle2.y + paddle2.vel <= 0)
		{
			paddle2.accel = 0;
			paddle2.vel = 0;
		}
		paddle2.y += paddle2.vel;
	}
	
	function drawPaddles(){
		// draw player 1's paddle
		ctx.fillStyle = paddle1.color;
		ctx.fillRect(paddle1.x - 5, paddle1.y - paddle1.length/2, 5, paddle1.length);
		
		// draw player 2's paddle
		ctx.fillStyle = paddle2.color;
		ctx.fillRect(paddle2.x, paddle2.y - paddle2.length/2, 5, paddle2.length);
	}
	
	function drawScore(){
		ctx.font = "20px Arial";
		ctx.fillStyle = paddle1.color;
		ctx.fillText("Player 1: " + score1, 50, 30);
		
		ctx.fillStyle = paddle2.color;
		ctx.fillText("Player 2: " + score2, 420, 30);
	}
	
	function onTimer(){
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		updateBall();
		drawBall();
		
		updatePaddles();
		drawPaddles();
		drawScore();
	}
	</script>
</body>
</html>